FROM nixos/nix

RUN nix-env -i git

WORKDIR /tmp

RUN git clone https://github.com/scala-native/scala-native.git native

RUN git clone https://github.com/scala-native/sbt-cross.git
  
WORKDIR /tmp/native

RUN  nix-shell bin/scala-native.nix -A clangEnv --run "clangEnv installed"

RUN  nix-shell bin/scala-native.nix -A clangEnv --run "cd .. && sbt scalaVersion"

RUN  nix-shell bin/scala-native.nix -A clangEnv --run "cd .. && cd sbt-cross && sbt publishLocal"

RUN  nix-shell bin/scala-native.nix -A clangEnv --run "sbt ';rtlib/publishLocal ;nscplugin/publishLocal'"

CMD ["/bin/bash"]
